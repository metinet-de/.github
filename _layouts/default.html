<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}" class="dark">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    {%- seo -%}

    <!-- Dark mode: apply class before render to avoid flash -->
    <script>
      (function() {
        var theme = localStorage.getItem('theme');
        // Default is dark unless user explicitly chose light
        if (theme === 'light') {
          document.documentElement.classList.remove('dark');
        } else {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>

    <!-- Tailwind CSS (built by CLI) -->
    <link rel="stylesheet" href="{{ "/assets/css/tailwind.css" | relative_url }}?v={{ site.time | date: '%s' }}">
    <link rel="stylesheet" href="{{ "/assets/css/style.css" | relative_url }}?v={{ site.time | date: '%s' }}">
    <!-- Prism dark theme -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    
    {%- feed_meta -%}
    
    {%- if jekyll.environment == 'production' and site.google_analytics -%}
      {%- include google-analytics.html -%}
    {%- endif -%}
  </head>

  <body class="bg-white dark:bg-[#060F1C] text-[#0D1A2E] dark:text-[#DCE9FF] transition-colors duration-200">
    {%- include header.html -%}

    <main id="main-content" class="page-content" aria-label="Content">
      <div class="wrapper">
        {{ content }}
      </div>
    </main>

    {%- include footer.html -%}
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
      (function () {
        var btn = document.getElementById('theme-toggle');
        var sun = document.getElementById('icon-sun');
        var moon = document.getElementById('icon-moon');

        function applyIcons() {
          var dark = document.documentElement.classList.contains('dark');
          sun.style.display  = dark  ? 'block' : 'none';
          moon.style.display = dark  ? 'none'  : 'block';
        }

        applyIcons();

        btn && btn.addEventListener('click', function () {
          var isDark = document.documentElement.classList.toggle('dark');
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
          applyIcons();
        });
      })();
    </script>
  </body>
</html>